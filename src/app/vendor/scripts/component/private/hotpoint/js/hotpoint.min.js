!function(a){function b(b){var e,d={maxZoom:3,minZoom:.5,radius:15,dock:"TC",imgError:!1,assistiveTool:"1",tbodyId:"tbody",renderToId:"legend-render",nopic:"",legendExist:!1,isShowAssistiveTool:!0,loading:!0,swfLegendWidth:0,swfLegendHeight:0,circleLineColor:{seekColor:"#FFDD00",checkedColor:"#FF1020"},callbacks:{onPrint:null,onToolClick:null,onBindPartList:null,onLegendDbClick:null,onLegendBeforeLoad:null,onLegendAfterLoad:null,onSelectionPartError:null}};return function(){var a=document.createElement("link"),b=require.s.contexts._.config.baseUrl+c+"css/hotpoint.css";a.type="text/css",a.rel="stylesheet",a.href=b,document.getElementsByTagName("head")[0].appendChild(a)}(),e=function(b){this.opts=a.extend(!0,{},d,b||{}),this.LEGEND_ID="legend",this.LEGEND_IMG_ID="legend-img",this.LEGEND_WRAP_ID="legend-wrap",this.percent=1,this.dictList={},this.isDone=!0,this.curCoords=[],this.curCallouts=[],this.dragLegendPosition={},this.radius=this.opts.radius,this.data=this.opts.data||[],this.dragAssisactiveToolPosition={},this.init()},e.prototype={init:function(){var a=this,b=a.opts;a.buildDomEl(),a.initGraphics(),a.bindResize(),a.bindEvent(),a.buildAssistiveTool(),a.opts.isBindLegend&&a.bindLegend({src:b.src,data:b.data,swfLegendWidth:b.swfLegendWidth,swfLegendHeight:b.swfLegendHeight})},buildDomEl:function(){var b=this,c=b.getLegendHTML();b.$renderTo=a("#"+b.opts.renderToId),b.$renderTo.append(c),b.$tbody=a("#"+b.opts.tbodyId),b.$legend=a("#"+b.LEGEND_ID),b.$legendWrap=a("#"+b.LEGEND_WRAP_ID)},getLegendHTML:function(){var a=this,b=[];return b.push('<div id="'+a.LEGEND_WRAP_ID+'" class="legend-wrap">'),b.push('<div id="'+a.LEGEND_ID+'" class="legend">'),b.push("</div>"),b.push("</div>"),b.join(" ")},initGraphics:function(){var a=this;a.graphics=new jsGraphics(a.$legend.get(0))},bindLegend:function(a,b){var c=this;c.destroyLegend(),c.data=a.data,c.swfLegendWidth=a.swfLegendWidth,c.swfLegendHeight=a.swfLegendHeight,c.setLegendSrc(a.src,b)},destroyLegend:function(){var a=this;a.data=null,a.dictList=null,a.buildData=[],a.curCoords=[],a.opts.legendExist=!1,a.resetLegend(),a.clearHotpoint(),a.$legend.html("")},setLegendSrc:function(b,c){var d=this,e=new Image,f=d.opts.callbacks.onLegendBeforeLoad,g=d.opts.callbacks.onLegendAfterLoad;"function"==typeof f&&f.apply(d,[]),d.opts.loading&&d.loadingShow(),a(e).on("load",function(){d.finishImgLoad(e,c),"function"==typeof g&&g.apply(d,[e])}).on("error",function(){"function"==typeof g&&g.apply(d,[e]),d.loadErrorImg()}).attr("src",b||"")},finishImgLoad:function(a,b){var c=this;c.opts.legendExist=!0,c.legendRawSize={width:a.width,height:a.height},c.settingSize(),c.$legend.html(a),c.buildCoord(c.data),!c.existAssistiveTool,"function"==typeof b&&b.apply(c,[]),c.opts.loading&&c.loadingHide(),c.disabledAccistiveTool()},loadErrorImg:function(){var a=this,b=a.opts.nopic;a.opts.legendExist=!1,a.legendRawSize={width:0,height:0},a.$legend.empty().css("background","url("+b+") no-repeat center center"),a.disabledAccistiveTool(),a.opts.loading&&a.loadingHide()},settingSize:function(){var a=this,b=a.$legendWrap.parent().width(),c=a.$legendWrap.parent().height(),d=a.opts.legendExist?a.scalingDownCalc(a.legendRawSize.width,a.legendRawSize.height,b,c):{top:0,left:0,width:b,height:c};a.$legend.css({top:d.top+"px",left:d.left+"px",width:d.width,height:d.height}),a.$legendWrap.css({width:b,height:c}),a.legendWidth=a.$legend.width(),a.legendHeight=a.$legend.height(),a.legendOffsetTop=a.$legend.offset().top,a.legendOffsetLeft=a.$legend.offset().left,a.x1=a.$legendWrap.offset().left,a.y1=a.$legendWrap.offset().top,a.x2=a.$legendWrap.offset().left+a.$legendWrap.width(),a.y2=a.$legendWrap.offset().top+a.$legendWrap.height()},buildCoord:function(a){var d,h,o,b=this,c=b.radius,e=0,f=0,g=0,i=0,j=0,k=0,l=0,m=0,n=0,p=b.swfLegendWidth/b.legendWidth,q=b.swfLegendHeight/b.legendHeight;for(b.dictList={},b.buildData=[];h=a[e];e++)if(h.x&&h.y)for(d=h.callout,i=parseInt(h.x/p),j=parseInt(h.y/q),b.buildData.push({x:i,y:j,callout:d}),k=i-c,l=i+c,m=j-c,n=j+c,f=k;l>f;f++)for(g=m;n>g;g++)o=f+"-"+g,b.dictList[o]={x:i,y:j}},bindResize:function(){var b=this;a(window).resize(function(){b.legendRawSize&&b.resizeToAdjust()})},resizeToAdjust:function(){var a=this;a.resetLegend(),a.settingSize(),a.buildCoord(a.data||[]),a.redraw(),a.assistiveToolDock(),a.linkHotpoint(a.curCallouts)},bindEvent:function(){var a=this;a.$legend.on({click:function(b){a.opts.legendExist&&a.clickLegend(b,this),b.preventDefault()},dblclick:function(b){"function"==typeof a.opts.callbacks.onLegendDbClick?a.opts.callbacks.onLegendDbClick.apply(a,[]):a.opts.legendExist&&a.zoomLegend(1,b),b.preventDefault()},mousemove:function(b){a.opts.legendExist&&a.seekHotpoint(b,this),b.preventDefault()},mousedown:function(b){a.percent>1&&a.opts.legendExist&&a.startDragLegend(b,this),b.preventDefault()},mousewheel:function(b,c){a.opts.legendExist&&a.zoomLegend(c,b),b.preventDefault()}}),null===a.opts.callbacks.onBindPartList&&a.$tbody.on("click","tr[data-callout]",function(){a.opts.legendExist&&a.rowsClick(this)}),a.$legendWrap.contextmenu(function(){return!1})},buildAssistiveTool:function(){var b=this,c=b.getAssistiveToolTemplate();b.$assistiveTool=a(c),b.$legendWrap.append(b.$assistiveTool),b.bindAssistiveToolEvent(),b.assistiveToolDock(),b.$assistiveTool.show(),b.existAssistiveTool=!0},disabledAccistiveTool:function(){var a=this,b=a.$assistiveTool.find("[data-action]");a.opts.legendExist?b.removeClass("disabled"):b.addClass("disabled")},bindAssistiveToolEvent:function(){var b=this;b.$assistiveTool.on("mousedown",function(a){b.startDragAssistiveTool(a,this)}),b.$assistiveTool.on("click","a:not([class*='disabled'])",function(){var d=a(this).attr("data-action");switch(d){case"zoomin":b.zoomIn();break;case"zoomout":b.zoomOut();break;case"up":b.moveUp();break;case"right":b.moveRight();break;case"down":b.moveDown();break;case"left":b.moveLeft();break;case"reset":b.resetLegend(),b.redraw();break;case"print":b.opts.callbacks.onPrint&&b.opts.callbacks.onPrint.apply(null,[]);break;default:b.opts.callbacks.onToolClick&&b.opts.callbacks.onToolClick.apply(null,[d])}})},assistiveToolDock:function(){if(this.opts.legendExist){var a=this,b=a.opts.dock,c=a.$legendWrap.height()-a.$assistiveTool.height()-5,d=a.$legendWrap.width()-a.$assistiveTool.width()-5,e=d/2;switch(b){case"TL":a.$assistiveTool.css({left:"5px",top:"5px"});break;case"TC":a.$assistiveTool.css({left:e+"px",top:"5px"});break;case"TR":a.$assistiveTool.css({left:d+"px",top:"5px"});break;case"BL":a.$assistiveTool.css({left:"5px",top:c+"px"});break;case"BC":a.$assistiveTool.css({left:e+"px",top:c+"px"});break;case"BR":a.$assistiveTool.css({left:d+"px",bottom:"0px"})}}},startDragAssistiveTool:function(b,c){var d=this,e={},f=d.getSizeAndPosition(d.$legendWrap),g=d.getSizeAndPosition(d.$assistiveTool);d.dragAssisactiveToolPosition.top=b.pageY-f.offsetTop-g.top,d.dragAssisactiveToolPosition.left=b.pageX-f.offsetLeft-g.left,a(document).bind({"mousemove.hotpoint":function(a){e=d.movingRange(a,c,d.dragAssisactiveToolPosition),d.dragMove(c,e),a.preventDefault()},"mouseup.hotpoint":function(){a(this).unbind("mousemove.hotpoint mouseup.hotpoint"),b.preventDefault()}})},rowsClick:function(b){var c=this,d=a(b).attr("data-callout");c.linkHotpoint([d])},seekHotpoint:function(a,b){var c=this,d="",e=c.getPosition(a,b),f=c.opts.circleLineColor.seekColor,g=c.getCoord(e.left,e.top),h=c.$legend.find("div[id^='t-']").attr("id");if(c.$legend.css("cursor","default"),"undefined"!=typeof g){if(c.$legend.css("cursor","pointer"),d="t-"+g.x+"-"+g.y,h===d)return;"undefined"!=typeof h&&c.clearHotpoint(h),c.checkCoordExist(g)&&c.drawHotpoint(d,g,f)}else"undefined"!=typeof h&&c.clearHotpoint(h)},checkCoordExist:function(a){for(var d,b=this,c=0;d=b.curCoords[c];c++)if(d.x==a.x&&d.y==a.y)return!1;return!0},clickLegend:function(a,b){var d,f,c=this,e=[],g=c.getPosition(a,b),h=c.getCoord(g.left,g.top),i=c.opts.callbacks.onSelectionCallout;"undefined"!=typeof h&&(d=c.getCallout(h.x,h.y),"undefined"!=typeof d&&(e.push(d.toString()),f=c.getCalloutCoord(e),f.length>0&&(c.clearHotpoint(),c.activateHotpoint(f,e),"function"==typeof i&&i.apply(c,[e])),c.curCoords=f),c.curCallouts=e)},startDragLegend:function(b,c){var d=this,e={},f=d.getSizeAndPosition(d.$legend),g=d.getSizeAndPosition(d.$legendWrap);d.dragLegendPosition.top=b.pageY-g.offsetTop-f.top,d.dragLegendPosition.left=b.pageX-g.offsetLeft-f.left,a(document).bind({"mousemove.hotpoint":function(a){e=d.getMovePosition(a,d.dragLegendPosition),d.dragMove(c,e),a.preventDefault()},"mouseup.hotpoint":function(){a(this).unbind("mousemove.hotpoint mouseup.hotpoint"),b.preventDefault()}})},getCallout:function(a,b){for(var f,c=this,d=0,e={};d<c.buildData.length;d++)if(e=c.buildData[d],e.x===a&&e.y===b){f=e.callout;break}return f},getCoord:function(a,b){var c=this,d=a+"-"+b,e=c.dictList[d];return e},drawHotpoint:function(b,c,d){if(this.opts.legendExist){var e=this,f=e.percent,g=c.x*f,h=c.y*f,i=e.radius*f,j=new jsColor(d),k=new jsPen(j,3),l=new jsPoint(g,h),m=e.graphics.drawCircle(k,l,i);a(m).attr({id:b,"data-type":"hotpoint"})}},activateHotpoint:function(a,b){for(var e,c=this,d=0,f=c.opts.circleLineColor.checkedColor;d<a.length;d++)e=a[d].x+"-"+a[d].y,c.drawHotpoint(e,a[d],f);b.length>0&&(c.settingsRowBg(b[0]),c.movingRowScrollTop(b[0]))},linkHotpoint:function(a){var b=this;b.clearHotpoint(),b.curCallouts=a,b.curCoords=b.getCalloutCoord(a),1===b.curCoords.length?(b.legendToCenter(b.curCoords[0].x,b.curCoords[0].y),b.activateHotpoint(b.curCoords,a)):(b.resetLegend(),b.redraw())},clearHotpoint:function(a){var b=this;a?b.$legend.find("#"+a).remove():b.$legend.find("div[data-type='hotpoint']").remove()},settingsRowBg:function(a){var b=this,c=b.opts.selectRowsBgClass,d=b.$tbody.find("tr[data-callout='"+a+"']");b.$tbody.find("tr").removeClass(c),d.addClass(c)},movingRowScrollTop:function(a){var b=this,c=b.$tbody.find("tr[data-callout='"+a+"']");c.length>0&&c.scrollIntoView()},movingRange:function(b,c,d){var e=this,f=5,g=5,h=e.getMovePosition(b,d),i=e.$legendWrap.width()-a(c).width()-5,j=e.$legendWrap.height()-a(c).height()-5;return h.left<f&&(h.left=f),h.top<g&&(h.top=g),h.left>i&&(h.left=i),h.top>j&&(h.top=j),h},dragMove:function(b,c){a(b).css({left:c.left+"px",top:c.top+"px"})},getMovePosition:function(a,b){var c=this,d=c.getSizeAndPosition(c.$legendWrap),e=a.pageY-d.offsetTop-b.top,f=a.pageX-d.offsetLeft-b.left;return{top:e,left:f}},zoomLegend:function(a,b){var e,c=this,d=1,f=1.2,g=0,h=0,m=c.getSizeAndPosition(c.$legend),n=c.getSizeAndPosition(c.$legendWrap);a>0?(h=m.width*f,g=m.height*f):(h=m.width/f,g=m.height/f),d=h/c.legendWidth,d>=c.opts.maxZoom||d<=c.opts.minZoom||(c.percent=d,c.$legend.width(h).height(g),e="undefined"==typeof b?{top:(n.height-g)/2,left:(n.width-h)/2}:c.getZoomPosition(b,m.width,m.height,h,g),c.$legend.css({left:e.left+"px",top:e.top+"px"}),c.redraw())},getZoomPosition:function(a,b,c,d,e){var f=this,g=f.getCursorPosition(a),h=f.getSizeAndPosition(f.$legendWrap),i=a.pageX-h.offsetLeft,j=a.pageY-h.offsetTop,k=(g.top/c).toFixed(2),l=(g.left/b).toFixed(2);return{top:j-e*k,left:i-d*l}},getCursorPosition:function(a){var b=this,c=b.getSizeAndPosition(b.$legendWrap),d=b.getSizeAndPosition(b.$legend);return{top:a.pageY-c.offsetTop-d.top,left:a.pageX-c.offsetLeft-d.left}},getPosition:function(a){var b=this,c=b.getSizeAndPosition(b.$legend),e=(b.getSizeAndPosition(b.$legendWrap),b.getLegendMarge()),f=parseInt((a.pageY-b.legendOffsetTop-c.top+e.margeTop)/b.percent),g=parseInt((a.pageX-b.legendOffsetLeft-c.left+e.margeLeft)/b.percent);return{top:f,left:g}},getLegendMarge:function(){var a=this,b=(a.$legendWrap.width()-a.legendWidth)/2,c=(a.$legendWrap.height()-a.legendHeight)/2;return{margeLeft:b,margeTop:c}},legendToCenter:function(a,b){var c=this,d=c.percent,e=c.getSizeAndPosition(c.$legend),f=c.getSizeAndPosition(c.$legendWrap),g=c.x1,h=c.y1,i=c.x2,j=c.y2,k=f.offsetTop+b*d+e.top-15,l=f.offsetLeft+a*d+e.left-15,m=f.height/2-b*d-15,n=f.width/2-a*d-15;l>g&&k>h&&i>l&&j>k||(0!==e.cssTop||0!==e.cssLeft||e.width!==c.legendWidth||e.height!==c.legendHeight)&&c.$legend.css({left:n+"px",top:m+"px"})},getSizeAndPosition:function(a){return{width:a.width(),height:a.height(),top:a.position().top,left:a.position().left,offsetTop:a.offset().top,offsetLeft:a.offset().left}},getCalloutCoord:function(b){for(var d,c=this,e=[],f=0,g=c.buildData;f<g.length;f++)d=g[f].callout.toString(),a.inArray(d,b)>-1&&e.push({x:g[f].x,y:g[f].y});return e},zoomIn:function(a){var b=this;b.zoomLegend(1,a)},zoomOut:function(a){var b=this;b.zoomLegend(0,a)},resetLegend:function(){var a=this,b=(a.$legendWrap.height()-a.legendHeight)/2,c=(a.$legendWrap.width()-a.legendWidth)/2;a.percent=1,a.$legend.css({top:b+"px",left:c+"px",width:a.legendWidth,height:a.legendHeight})},moveUp:function(){var a=this;a.isDone&&a.percent>1&&(a.isDone=!1,a.$legend.animate({top:"+=100px"},"slow",function(){a.isDone=!0}))},moveLeft:function(){var a=this;a.isDone&&a.percent>1&&(a.isDone=!1,a.$legend.animate({left:"+=100px"},"slow",function(){a.isDone=!0}))},moveRight:function(){var a=this;a.isDone&&a.percent>1&&(a.isDone=!1,a.$legend.animate({left:"-=100px"},"slow",function(){a.isDone=!0}))},moveDown:function(){var a=this;a.isDone&&a.percent>1&&(a.isDone=!1,a.$legend.animate({top:"-=100px"},"slow",function(){a.isDone=!0}))},redraw:function(){var a=this;a.curCoords.length>0&&(a.clearHotpoint(),a.activateHotpoint(a.curCoords,a.curCallouts))},scalingDownCalc:function(a,b,c,d){var e,f,g,h;return b/a>=d/c?b>d?(f=d,e=a*d/b):(e=a,f=b):a>c?(e=c,f=b*c/a):(e=a,f=b),g=(d-f)/2,h=(c-e)/2,{width:e,height:f,top:g,left:h}},getAssistiveToolTemplate:function(){var c=this,d=c.opts.assistiveTool;return a(b).wrap("<div></div>").parent().find("div[data-template-id='"+d+"']").get(0).outerHTML},loadingShow:function(){var a=this,b='<span style="display:block;line-height:28px;font-family:微软雅黑,font-size:10pt;height:28px;">loading...</span>';a.$legendWrap.block({message:b,baseZ:900,css:{width:"15%"}})},loadingHide:function(){var a=this;a.$legendWrap.unblock()}},e}if("function"==typeof define&&define.amd&&define.amd.jQuery){var c=function(){var a,b=require.s.contexts._.config,c=b.paths["hotpoint"];return"undefined"!=typeof c?(a=c.split(/\/+/g),a.slice(0,a.length-2).join("/")+"/"):(alert("require config paths 'hotpoint' key not exist"),void 0)}();define(["text!"+c+"template/assistive-template.htm","mousewheel","normalize","jsDraw2D","scrollIntoView"],b)}else b(jQuery)}(jQuery);